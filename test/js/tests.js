// Generated by CoffeeScript 1.3.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  window.duck.App = (function() {

    function App() {
      this.bill = new duck.Bill(this);
      this.brain = new duck.Brain(this);
    }

    return App;

  })();

  $(function() {
    return window.exposed_duck = new duck.App;
  });

  duck.Bill = (function() {

    function Bill(duck) {
      this.duck = duck;
      this.navigation = new window.duck.Navigation(this.duck);
      this.success = new window.duck.Success(this.duck);
    }

    return Bill;

  })();

  duck.Brain = (function() {

    function Brain(duck) {
      this.duck = duck;
      $(this.duck).on('quack', this.quack);
    }

    Brain.prototype.quack = function(event, options) {
      console.log(options.message);
      return $(this.duck).trigger('response', {
        next_question: 'Hello.',
        answer_type: 'short'
      });
    };

    return Brain;

  })();

  duck.Conversation = (function() {

    function Conversation() {
      this.conversation = [];
    }

    Conversation.prototype.add = function(question, answer) {
      return this.conversation.push({
        question: question,
        answer: answer
      });
    };

    return Conversation;

  })();

  window.duck.Navigation = (function() {

    function Navigation(duck) {
      this.duck = duck;
      this.go = __bind(this.go, this);

      this.bindUI = __bind(this.bindUI, this);

      this.bindUI();
    }

    Navigation.prototype.bindUI = function() {
      return $('nav a').click(this.go);
    };

    Navigation.prototype.go = function(event) {
      var link, target;
      event.preventDefault();
      link = $(event.currentTarget);
      target = $(link.attr('href'));
      return $('html, body').animate({
        scrollTop: target.offset().top
      }, 2000);
    };

    return Navigation;

  })();

  duck.PatternMatcher = (function() {

    function PatternMatcher(str) {
      this.str = str;
    }

    PatternMatcher.prototype.toString = function() {
      return this.str;
    };

    PatternMatcher.prototype.toTokens = function() {
      return this.str;
    };

    PatternMatcher.prototype.toSentances = function() {
      return $.map(this.str.split('.'), function() {
        return new duck.PatternMatcher();
      });
    };

    return PatternMatcher;

  })();

  window.duck.Success = (function() {

    function Success(duck) {
      this.duck = duck;
      this.done = __bind(this.done, this);

      this.bindUI = __bind(this.bindUI, this);

      this.bindUI();
    }

    Success.prototype.bindUI = function() {
      return $('.done').click(this.done);
    };

    Success.prototype.done = function(event) {
      event.preventDefault();
      return $('.congratulations').slideDown();
    };

    return Success;

  })();

  describe("The Brain", function() {
    it("can be instantiated", function() {
      return expect(function() {
        return new duck.Brain(function() {});
      }).not.toThrow();
    });
    return describe("when processing text", function() {
      beforeEach(function() {
        this.duck = function() {};
        return this.brain = new duck.Brain(this.duck);
      });
      return it("can give an answer", function() {
        $(this.duck).on('response', function(event, response) {
          return expect(response['next_question']).toEqual("Hello.");
        });
        return this.brain.quack({}, {
          message: "Hi, ducky"
        });
      });
    });
  });

  describe("The duck", function() {
    return it("can be instantiated", function() {
      return expect(function() {
        return new duck.App();
      }).not.toThrow();
    });
  });

  describe("The Brain's Pattern Matcher", function() {
    it("can be instantiated", function() {
      return expect(function() {
        return new duck.PatternMatcher("some text");
      }).not.toThrow();
    });
    return describe("when given multiple sentances", function() {
      beforeEach(function() {
        var text;
        text = "I'm not a pheasant plucker, I'm a pheasant plucker's son. I'm only plucking pheasants til the pheasant plucker comes.";
        return this.matcher = new duck.PatternMatcher(text);
      });
      return it("can produce an array of sentance patterns", function() {
        var sentances;
        sentances = this.matcher.toSentances();
        return expect(sentances[0].toSentances).toBeDefined();
      });
    });
  });

}).call(this);
